<!DOCTYPE html>
<html lang="pt-BR" data-color-scheme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BG Tech | CFO Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
  <style>
    @font-face {
      font-family: 'FKGroteskNeue';
      src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
    }

    :root {
      --color-bg: #030712;
      --color-surface: #0d1117;
      --color-card: rgba(13,17,23,0.8);
      --color-border: rgba(255,255,255,0.07);
      --color-border-hover: rgba(14,165,233,0.3);
      --primary: #0ea5e9;
      --primary-dark: #0284c7;
      --primary-glow: rgba(14,165,233,0.3);
      --danger: #ef4444;
      --danger-glow: rgba(239,68,68,0.2);
      --warning: #f59e0b;
      --warning-glow: rgba(245,158,11,0.2);
      --success: #10b981;
      --success-glow: rgba(16,185,129,0.2);
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --text-dim: #475569;
      --sidebar-w: 260px;
      --radius: 16px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--color-bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .font-title { font-family: 'Plus Jakarta Sans', sans-serif; }

    /* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 99px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

    /* ‚îÄ‚îÄ‚îÄ BG DECORATION ‚îÄ‚îÄ‚îÄ */
    .bg-grid {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background-image: linear-gradient(rgba(14,165,233,0.025) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(14,165,233,0.025) 1px, transparent 1px);
      background-size: 48px 48px;
    }
    .bg-glow {
      position: fixed; border-radius: 50%; pointer-events: none; z-index: 0;
      filter: blur(80px);
    }
    .bg-glow-1 { width: 700px; height: 700px; background: rgba(14,165,233,0.08); top: -200px; right: -200px; }
    .bg-glow-2 { width: 600px; height: 600px; background: rgba(239,68,68,0.06); bottom: -200px; left: -150px; }

    /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
    #login-screen {
      position: fixed; inset: 0; z-index: 1000;
      display: flex; align-items: center; justify-content: center;
      background: var(--color-bg);
    }
    .app { display: none; min-height: 100vh; }
    .app.visible { display: flex; }

    /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
    .sidebar {
      position: fixed; top: 0; left: 0; bottom: 0;
      width: var(--sidebar-w);
      background: rgba(3,7,18,0.95);
      border-right: 1px solid var(--color-border);
      backdrop-filter: blur(20px);
      display: flex; flex-direction: column;
      padding: 32px 16px;
      z-index: 100;
      transition: transform 0.35s cubic-bezier(0.16,1,0.3,1);
    }
    .sidebar-logo {
      display: flex; align-items: center; gap: 12px;
      padding: 0 8px 40px;
    }
    .sidebar-logo h1 {
      font-family: 'Plus Jakarta Sans', sans-serif;
      font-size: 22px; font-weight: 900; letter-spacing: -0.02em;
    }
    .sidebar-logo span { color: var(--primary); }
    .sidebar-logo svg { color: var(--primary); filter: drop-shadow(0 0 8px rgba(14,165,233,0.5)); }

    nav { flex: 1; display: flex; flex-direction: column; gap: 4px; }

    .nav-btn {
      display: flex; align-items: center; gap: 12px;
      width: 100%; padding: 12px 16px;
      border: 1px solid transparent; border-radius: 12px;
      background: transparent; color: var(--text-muted);
      font-size: 14px; font-weight: 600; cursor: pointer;
      transition: all 0.2s ease; text-align: left;
      position: relative;
    }
    .nav-btn:hover { color: var(--text); background: rgba(255,255,255,0.04); }
    .nav-btn.active {
      background: rgba(14,165,233,0.1);
      color: var(--primary);
      border-color: rgba(14,165,233,0.15);
    }
    .nav-btn.active::before {
      content: ''; position: absolute; left: -1px; top: 25%; bottom: 25%;
      width: 3px; background: var(--primary); border-radius: 0 3px 3px 0;
    }

    .sidebar-footer {
      margin-top: 16px; padding: 12px 14px;
      background: rgba(0,0,0,0.3); border: 1px solid var(--color-border);
      border-radius: 12px; display: flex; align-items: center; gap: 10px;
      font-size: 12px; font-weight: 600; color: var(--text-muted);
    }
    .sync-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--success); box-shadow: 0 0 8px var(--success);
      flex-shrink: 0;
    }

    /* ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1; min-width: 0;
      padding: 40px clamp(20px, 4vw, 56px) 60px;
      position: relative; z-index: 1;
    }

    /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
    .page-header {
      display: flex; justify-content: space-between; align-items: flex-end;
      gap: 20px; flex-wrap: wrap; margin-bottom: 40px;
    }
    .page-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: clamp(26px,4vw,36px); font-weight: 900; letter-spacing: -0.02em; }
    .page-sub { color: var(--text-muted); font-size: 14px; font-weight: 500; margin-top: 6px; }
    .header-right { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }

    /* ‚îÄ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ‚îÄ */
    .filter-group {
      display: flex; background: rgba(0,0,0,0.5);
      border: 1px solid var(--color-border); border-radius: 12px;
      overflow: hidden;
    }
    .filter-select {
      background: transparent; color: var(--text); border: none;
      padding: 10px 14px; font-size: 13px; font-weight: 700;
      cursor: pointer; appearance: none; outline: none;
    }
    .filter-select option { background: #0d1117; }
    .filter-sep { width: 1px; background: var(--color-border); margin: 8px 0; }

    /* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
    .btn-primary {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 11px 20px; border-radius: 12px; border: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white; font-size: 14px; font-weight: 700; cursor: pointer;
      box-shadow: 0 4px 16px var(--primary-glow);
      transition: all 0.25s ease; white-space: nowrap;
    }
    .btn-primary:hover { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 8px 24px var(--primary-glow); }
    .btn-primary:active { transform: none; }

    .btn-ghost {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 10px 16px; border-radius: 10px;
      border: 1px solid var(--color-border);
      background: transparent; color: var(--text-muted);
      font-size: 13px; font-weight: 600; cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-ghost:hover { color: var(--text); background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.12); }

    /* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
    .card {
      background: var(--color-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      transition: all 0.25s ease;
    }
    .card:hover { border-color: rgba(255,255,255,0.1); box-shadow: 0 12px 40px rgba(0,0,0,0.5); }

    /* ‚îÄ‚îÄ‚îÄ STATS GRID ‚îÄ‚îÄ‚îÄ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px; margin-bottom: 28px;
    }
    .stat-card { padding: 24px; border-top: 3px solid transparent; }
    .stat-card.c-danger { border-top-color: var(--danger); }
    .stat-card.c-primary { border-top-color: var(--primary); }
    .stat-card.c-warning { border-top-color: var(--warning); }
    .stat-card.c-success { border-top-color: var(--success); }
    .stat-label { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin-bottom: 14px; display: flex; justify-content: space-between; align-items: center; }
    .stat-value { font-family: 'Plus Jakarta Sans', sans-serif; font-size: clamp(24px,3vw,32px); font-weight: 900; letter-spacing: -0.02em; color: var(--text); }
    .stat-sub { font-size: 12px; color: var(--text-dim); font-weight: 500; margin-top: 8px; }

    /* ‚îÄ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ‚îÄ */
    .charts-row { display: grid; grid-template-columns: 3fr 2fr; gap: 20px; margin-bottom: 28px; }
    .chart-card { padding: 24px; }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .chart-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 16px; font-weight: 800; }
    .chart-sub { font-size: 12px; color: var(--text-muted); font-weight: 600; }
    #chart-area, #chart-donut { min-height: 280px; }

    /* ‚îÄ‚îÄ‚îÄ ANNUAL VIEW ‚îÄ‚îÄ‚îÄ */
    .annual-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px,1fr)); gap: 14px; }
    .month-tile {
      padding: 18px; border-radius: 14px; cursor: pointer;
      border: 1px solid var(--color-border);
      background: rgba(255,255,255,0.02);
      transition: all 0.2s ease;
    }
    .month-tile:hover { background: rgba(14,165,233,0.05); border-color: rgba(14,165,233,0.2); transform: translateY(-2px); }
    .month-tile.current { border-color: rgba(14,165,233,0.35); background: rgba(14,165,233,0.07); }
    .month-tile-name { font-size: 13px; font-weight: 700; color: var(--text-muted); margin-bottom: 10px; }
    .month-tile-val { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 18px; font-weight: 900; color: var(--text); }
    .month-tile-sub { font-size: 11px; color: var(--text-dim); margin-top: 4px; }
    .month-tile-bar { height: 3px; border-radius: 2px; background: rgba(255,255,255,0.06); margin-top: 12px; overflow: hidden; }
    .month-tile-fill { height: 100%; background: var(--primary); border-radius: 2px; transition: width 0.5s ease; }

    /* ‚îÄ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ‚îÄ */
    .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .data-table { width: 100%; min-width: 780px; border-collapse: collapse; }
    .data-table th {
      padding: 16px 20px; font-size: 11px; font-weight: 800;
      text-transform: uppercase; letter-spacing: 0.1em;
      color: var(--text-dim); border-bottom: 1px solid var(--color-border);
      background: rgba(0,0,0,0.2); white-space: nowrap;
    }
    .data-table td { padding: 18px 20px; border-bottom: 1px solid var(--color-border); vertical-align: middle; }
    .data-table tr:last-child td { border-bottom: none; }
    .data-table tr:hover td { background: rgba(14,165,233,0.03); }
    .item-name { font-size: 15px; font-weight: 700; color: var(--text); }
    .item-desc { font-size: 12px; color: var(--text-dim); margin-top: 3px; }
    .cat-badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; background: rgba(14,165,233,0.1); color: var(--primary); border: 1px solid rgba(14,165,233,0.18); }
    .recur-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em; }
    .recur-badge.sim { background: rgba(16,185,129,0.1); color: var(--success); }
    .recur-badge.nao { background: rgba(148,163,184,0.08); color: var(--text-dim); }
    .status-badge { display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.05em; white-space: nowrap; }
    .status-badge.pago { background: rgba(16,185,129,0.1); color: var(--success); border: 1px solid rgba(16,185,129,0.2); }
    .status-badge.pendente { background: rgba(245,158,11,0.1); color: var(--warning); border: 1px solid rgba(245,158,11,0.2); }
    .amount-cell { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 16px; font-weight: 800; text-align: right; white-space: nowrap; }
    .action-btn { background: transparent; border: none; color: var(--text-dim); cursor: pointer; padding: 7px; border-radius: 8px; transition: all 0.2s; display: inline-flex; }
    .action-btn:hover { background: rgba(255,255,255,0.06); color: var(--text); }
    .action-btn.del:hover { background: rgba(239,68,68,0.1); color: var(--danger); }

    /* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
    .empty-state { text-align: center; padding: 80px 24px; color: var(--text-muted); }
    .empty-state svg { width: 48px; height: 48px; opacity: 0.25; margin-bottom: 16px; }
    .empty-state h3 { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
    .empty-state p { font-size: 13px; color: var(--text-dim); }

    /* ‚îÄ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ‚îÄ */
    .drawer-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px); z-index: 200;
      opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .drawer-overlay.open { opacity: 1; pointer-events: all; }
    .drawer {
      position: fixed; top: 0; right: -100%; bottom: 0;
      width: min(560px, 100vw);
      background: #0d1117; border-left: 1px solid var(--color-border);
      z-index: 201; padding: clamp(24px,5vw,44px);
      overflow-y: auto; transition: right 0.4s cubic-bezier(0.16,1,0.3,1);
      box-shadow: -20px 0 60px rgba(0,0,0,0.8);
    }
    .drawer.open { right: 0; }
    .drawer-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
    .drawer-title { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 22px; font-weight: 900; }

    .type-tabs { display: flex; background: rgba(0,0,0,0.5); border: 1px solid var(--color-border); border-radius: 14px; padding: 6px; gap: 6px; margin-bottom: 28px; }
    .type-tab { flex: 1; padding: 12px; border: none; background: transparent; color: var(--text-muted); font-size: 14px; font-weight: 700; border-radius: 10px; cursor: pointer; transition: all 0.25s ease; }
    .type-tab.active { background: rgba(255,255,255,0.06); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.4); }

    .form-group { margin-bottom: 20px; }
    .form-label { font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); margin-bottom: 8px; display: block; }
    .form-input {
      width: 100%; padding: 14px 16px; border-radius: 12px;
      background: rgba(0,0,0,0.5); border: 1px solid var(--color-border);
      color: var(--text); font-size: 15px; font-weight: 500;
      transition: all 0.2s ease; outline: none;
    }
    .form-input:focus { border-color: var(--primary); background: rgba(14,165,233,0.04); box-shadow: 0 0 0 3px rgba(14,165,233,0.15); }
    .form-input::placeholder { color: var(--text-dim); }
    select.form-input { cursor: pointer; }
    select.form-input option { background: #0d1117; }
    .form-hint { font-size: 11px; color: var(--text-dim); margin-top: 6px; font-weight: 500; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .form-save { width: 100%; padding: 16px; border-radius: 14px; border: none; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; font-size: 16px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 6px 20px var(--primary-glow); transition: all 0.25s ease; margin-top: 28px; }
    .form-save:hover { filter: brightness(1.1); transform: translateY(-1px); }

    /* ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ */
    .login-card { width: 100%; max-width: 420px; margin: 24px; padding: 52px 40px; text-align: center; }
    .login-logo { display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px; }
    .login-logo h1 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 36px; font-weight: 900; }
    .login-logo span { color: var(--primary); }
    .login-logo svg { color: var(--primary); filter: drop-shadow(0 0 10px rgba(14,165,233,0.6)); }
    .login-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 99px; background: rgba(14,165,233,0.1); border: 1px solid rgba(14,165,233,0.25); color: var(--primary); font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 44px; }
    .login-field { position: relative; margin-bottom: 16px; }
    .login-input { width: 100%; padding: 15px 16px 15px 48px; border-radius: 14px; background: rgba(0,0,0,0.6); border: 1px solid var(--color-border); color: var(--text); font-size: 16px; outline: none; transition: all 0.2s; }
    .login-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(14,165,233,0.15); }
    .login-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-dim); pointer-events: none; }
    input:-webkit-autofill, input:-webkit-autofill:focus { -webkit-box-shadow: 0 0 0 50px #0d1117 inset; -webkit-text-fill-color: white; }

    /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
    #toast-wrap { position: fixed; bottom: 28px; right: 28px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
    .toast { background: #0d1117; border: 1px solid var(--color-border); border-left: 4px solid var(--primary); padding: 14px 20px; border-radius: 14px; color: var(--text); font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 10px; transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.16,1,0.3,1); box-shadow: 0 8px 32px rgba(0,0,0,0.6); backdrop-filter: blur(12px); max-width: 340px; }
    .toast.show { transform: translateX(0); }
    .toast.err { border-left-color: var(--danger); }

    /* ‚îÄ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ‚îÄ */
    .mobile-bar { display: none; }
    @media (max-width: 900px) {
      .sidebar { transform: translateX(-100%); }
      .main { margin-left: 0; padding: 28px 16px 100px; }
      .charts-row { grid-template-columns: 1fr; }
      .form-grid { grid-template-columns: 1fr; }
      .page-header { flex-direction: column; align-items: stretch; gap: 16px; }
      .header-right { flex-direction: column; }
      .filter-group { width: 100%; }
      .mobile-bar {
        display: flex; position: fixed; bottom: 0; left: 0; right: 0;
        background: rgba(3,7,18,0.97); border-top: 1px solid var(--color-border);
        padding: 10px 8px calc(10px + env(safe-area-inset-bottom));
        z-index: 150; justify-content: space-around;
        backdrop-filter: blur(20px);
      }
      .m-btn { background: none; border: none; color: var(--text-dim); display: flex; flex-direction: column; align-items: center; gap: 5px; font-size: 10px; font-weight: 700; cursor: pointer; padding: 6px 12px; border-radius: 10px; transition: all 0.25s ease; }
      .m-btn.active { color: var(--primary); background: rgba(14,165,233,0.1); }
    }

    /* Section visibility */
    .view { display: none; }
    .view.active { display: block; }
  </style>
</head>
<body>

<!-- BG -->
<div class="bg-grid"></div>
<div class="bg-glow bg-glow-1"></div>
<div class="bg-glow bg-glow-2"></div>

<!-- ‚îÄ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ -->
<div id="login-screen">
  <div class="card login-card">
    <div class="login-logo">
      <i data-lucide="cpu" width="36" height="36"></i>
      <h1>BG <span>TECH</span></h1>
    </div>
    <div style="margin-bottom:44px;">
      <span class="login-badge">
        <i data-lucide="shield-check" width="14" height="14"></i>
        Acesso Restrito CFO
      </span>
    </div>
    <div class="login-field">
      <input type="text" id="lu" class="login-input" placeholder="ID de Acesso" autocomplete="username">
      <i data-lucide="user" width="18" height="18" class="login-icon"></i>
    </div>
    <div class="login-field" style="margin-bottom:36px;">
      <input type="password" id="lp" class="login-input" placeholder="Senha do Cofre" autocomplete="current-password">
      <i data-lucide="key" width="18" height="18" class="login-icon"></i>
    </div>
    <button class="btn-primary" style="width:100%;padding:16px;font-size:16px;justify-content:center;" onclick="A.login()">
      Destrancar Sistema <i data-lucide="arrow-right" width="18" height="18"></i>
    </button>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ -->
<div class="app" id="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <i data-lucide="cpu" width="26" height="26"></i>
      <h1>BG <span>TECH</span></h1>
    </div>
    <nav>
      <button class="nav-btn active" data-tab="overview" onclick="A.tab('overview')">
        <i data-lucide="layout-dashboard" width="17" height="17"></i> Painel Geral
      </button>
      <button class="nav-btn" data-tab="annual" onclick="A.tab('annual')">
        <i data-lucide="calendar-range" width="17" height="17"></i> Balan√ßo Anual
      </button>
      <button class="nav-btn" data-tab="fixos" onclick="A.tab('fixos')">
        <i data-lucide="anchor" width="17" height="17"></i> Custos Fixos
      </button>
      <button class="nav-btn" data-tab="unicos" onclick="A.tab('unicos')">
        <i data-lucide="zap" width="17" height="17"></i> Gastos Vari√°veis
      </button>
    </nav>
    <div class="sidebar-footer">
      <div class="sync-dot" id="sync-dot"></div>
      <span id="sync-txt">Conectado</span>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="page-header">
      <div>
        <h2 class="page-title font-title" id="page-title">Painel Geral</h2>
        <p class="page-sub" id="page-sub">Monitoramento de despesas operacionais.</p>
      </div>
      <div class="header-right">
        <div class="filter-group">
          <select id="fMonth" class="filter-select" onchange="A.render()">
            <option value="anual">üìä Balan√ßo Anual</option>
          </select>
          <div class="filter-sep"></div>
          <select id="fYear" class="filter-select" onchange="A.render()">
            <option value="2025">2025</option>
            <option value="2026" selected>2026</option>
          </select>
        </div>
        <button class="btn-primary" onclick="A.openDrawer()">
          <i data-lucide="plus" width="16" height="16"></i> Novo Gasto
        </button>
      </div>
    </header>

    <!-- VIEW: OVERVIEW -->
    <div id="view-overview" class="view active">
      <div class="stats-grid">
        <div class="card stat-card c-danger">
          <div class="stat-label">Sangria Total <i data-lucide="trending-down" width="16" height="16" style="color:var(--danger)"></i></div>
          <div class="stat-value font-title" id="v-total">R$ 0,00</div>
          <div class="stat-sub">Soma de todos os gastos</div>
        </div>
        <div class="card stat-card c-primary">
          <div class="stat-label">Custo Fixo <i data-lucide="anchor" width="16" height="16" style="color:var(--primary)"></i></div>
          <div class="stat-value font-title" id="v-fixos">R$ 0,00</div>
          <div class="stat-sub">Despesas recorrentes</div>
        </div>
        <div class="card stat-card c-warning">
          <div class="stat-label">Vari√°veis <i data-lucide="zap" width="16" height="16" style="color:var(--warning)"></i></div>
          <div class="stat-value font-title" id="v-unicos">R$ 0,00</div>
          <div class="stat-sub">Gastos n√£o recorrentes</div>
        </div>
        <div class="card stat-card c-success">
          <div class="stat-label">Assinaturas Ativas <i data-lucide="repeat" width="16" height="16" style="color:var(--success)"></i></div>
          <div class="stat-value font-title" id="v-subs">0</div>
          <div class="stat-sub">Softwares e servi√ßos mensais</div>
        </div>
      </div>
      <div class="charts-row">
        <div class="card chart-card">
          <div class="chart-header">
            <span class="chart-title font-title">Curva de Gastos</span>
            <span class="chart-sub">√öltimos 6 meses</span>
          </div>
          <div id="chart-area"></div>
        </div>
        <div class="card chart-card">
          <div class="chart-header">
            <span class="chart-title font-title">Distribui√ß√£o Fixos</span>
            <span class="chart-sub">Por categoria</span>
          </div>
          <div id="chart-donut"></div>
        </div>
      </div>
    </div>

    <!-- VIEW: ANNUAL BALANCE -->
    <div id="view-annual" class="view">
      <div class="card" style="padding:28px;margin-bottom:24px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
          <div>
            <div class="chart-title font-title" id="annual-title">Balan√ßo Anual 2026</div>
            <div style="font-size:13px;color:var(--text-muted);margin-top:4px;">Clique em um m√™s para visualizar os detalhes</div>
          </div>
          <div style="display:flex;gap:16px;flex-wrap:wrap;">
            <div style="text-align:center;">
              <div style="font-size:11px;color:var(--text-dim);font-weight:700;text-transform:uppercase;letter-spacing:0.06em;margin-bottom:4px;">Total Ano</div>
              <div class="font-title" style="font-size:22px;font-weight:900;" id="annual-total">R$ 0,00</div>
            </div>
            <div style="text-align:center;">
              <div style="font-size:11px;color:var(--text-dim);font-weight:700;text-transform:uppercase;letter-spacing:0.06em;margin-bottom:4px;">M√©dia/M√™s</div>
              <div class="font-title" style="font-size:22px;font-weight:900;" id="annual-avg">R$ 0,00</div>
            </div>
          </div>
        </div>
        <div class="annual-grid" id="annual-grid"></div>
      </div>
    </div>

    <!-- VIEW: LIST (fixos / unicos) -->
    <div id="view-list" class="view">
      <div class="card" style="overflow:hidden;">
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Descri√ß√£o</th>
                <th>Categoria</th>
                <th>Recorr√™ncia</th>
                <th>Status</th>
                <th style="text-align:right">Valor</th>
                <th style="text-align:center">A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="table-body"></tbody>
          </table>
        </div>
        <div id="table-empty" class="empty-state" style="display:none;">
          <i data-lucide="check-circle"></i>
          <h3>Nenhum registro encontrado</h3>
          <p>Adicione um novo gasto para come√ßar.</p>
        </div>
      </div>
    </div>

  </main>

  <!-- MOBILE NAV -->
  <nav class="mobile-bar">
    <button class="m-btn active" data-tab="overview" onclick="A.tab('overview')"><i data-lucide="layout-dashboard" width="20" height="20"></i>Painel</button>
    <button class="m-btn" data-tab="annual" onclick="A.tab('annual')"><i data-lucide="calendar-range" width="20" height="20"></i>Anual</button>
    <button class="m-btn" data-tab="fixos" onclick="A.tab('fixos')"><i data-lucide="anchor" width="20" height="20"></i>Fixos</button>
    <button class="m-btn" data-tab="unicos" onclick="A.tab('unicos')"><i data-lucide="zap" width="20" height="20"></i>Vari√°veis</button>
    <button class="m-btn" onclick="A.openDrawer()" style="color:var(--primary)"><i data-lucide="plus-circle" width="20" height="20"></i>Novo</button>
  </nav>
</div>

<!-- ‚îÄ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ‚îÄ -->
<div class="drawer-overlay" id="overlay" onclick="A.closeDrawer()"></div>
<div class="drawer" id="drawer">
  <div class="drawer-head">
    <h2 class="drawer-title font-title" id="drawer-title">Novo Gasto</h2>
    <button class="btn-ghost" onclick="A.closeDrawer()" style="padding:8px;">
      <i data-lucide="x" width="18" height="18"></i>
    </button>
  </div>

  <input type="hidden" id="f-id">

  <div class="type-tabs">
    <button class="type-tab active" id="tab-fixos" onclick="A.setType('fixos')">üìå Custo Fixo</button>
    <button class="type-tab" id="tab-unicos" onclick="A.setType('unicos')">‚ö° Vari√°vel</button>
  </div>

  <div class="form-group">
    <label class="form-label">O que est√° sendo pago? *</label>
    <input type="text" id="f-nome" class="form-input" placeholder="Ex: Assinatura Notion, Servidor..." autocomplete="off">
  </div>

  <div class="form-grid">
    <div class="form-group">
      <label class="form-label">Valor (R$) *</label>
      <input type="text" id="f-valor" class="form-input" placeholder="0,00" oninput="A.maskMoney(event)">
    </div>
    <div class="form-group">
      <label class="form-label">Data / Vencimento</label>
      <input type="date" id="f-data" class="form-input">
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">Tipo de Recorr√™ncia</label>
    <select id="f-recor" class="form-input" onchange="A.onRecorChange()">
      <option value="unico">üî¥ √önico ‚Äî lan√ßamento manual</option>
      <option value="mensal">üîÑ Mensal ‚Äî replica todo m√™s do ano automaticamente</option>
      <option value="proximo">üìÖ Pr√≥ximos Meses ‚Äî replica a partir da data informada</option>
    </select>
    <div class="form-hint" id="recor-hint">Lan√ßamento pontual, somente neste m√™s.</div>
  </div>

  <div class="form-group">
    <label class="form-label">Categoria</label>
    <select id="f-cat" class="form-input"></select>
  </div>

  <div class="form-group">
    <label class="form-label">Status do Pagamento</label>
    <select id="f-status" class="form-input">
      <option value="Pago">‚úÖ Pago</option>
      <option value="Pendente">‚è≥ Pendente</option>
    </select>
  </div>

  <div class="form-group">
    <label class="form-label">Observa√ß√£o (opcional)</label>
    <input type="text" id="f-desc" class="form-input" placeholder="Detalhes adicionais..." autocomplete="off">
  </div>

  <button class="form-save" onclick="A.save()">
    <i data-lucide="save" width="18" height="18"></i> Salvar Registro
  </button>
</div>

<div id="toast-wrap"></div>

<script>
const DB = {
  url: "https://urpuiznydrlwmaqhdids.supabase.co/rest/v1/painel_gastos?id=eq.1",
  key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVycHVpem55ZHJsd21hcWhkaWRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzczMTM5OTcsImV4cCI6MjA1Mjg4OTk5N30.1yOEoCa5jS6eqXaEPGaO_VBH6Bfv3AqNmGEOnN0xXYg"
};
const MONTHS = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
const CATS = {
  fixos: ["Software e Automa√ß√£o","Nuvem e Infra","Pr√≥-labore e Equipe","Marketing Fixo","Estrutura","Outros Custos Fixos"],
  unicos: ["Hardware e Pe√ßas","Tr√°fego Pago","Impostos e Taxas","Terceirizados","Eventos","Gasto N√£o Previsto"]
};
const RECOR_HINTS = {
  unico: "Lan√ßamento pontual, somente neste m√™s.",
  mensal: "Replica automaticamente para todos os 12 meses do ano selecionado.",
  proximo: "Replica a partir do m√™s da data informada at√© dezembro do mesmo ano."
};

const A = {
  state: { tab: 'overview', type: 'fixos', data: { fixos: [], unicos: [] } },
  ch: { area: null, donut: null },

  init() {
    lucide.createIcons();
    const sel = document.getElementById('fMonth');
    MONTHS.forEach((m, i) => sel.innerHTML += `<option value="${i}">${m}</option>`);
    sel.value = new Date().getMonth();
    document.getElementById('lp').addEventListener('keypress', e => { if(e.key === 'Enter') A.login(); });
  },

  login() {
    const u = document.getElementById('lu').value.trim().toLowerCase();
    const p = document.getElementById('lp').value;
    if(u === 'bgtech' && p === 'admin2024') {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('app').classList.add('visible');
      A.initCharts();
      A.fetchSync();
      setInterval(() => A.fetchSync(true), 15000);
      lucide.createIcons();
    } else {
      A.toast("Credenciais inv√°lidas.", "err");
    }
  },

  tab(t) {
    A.state.tab = t;
    document.querySelectorAll('[data-tab]').forEach(b => b.classList.toggle('active', b.dataset.tab === t));
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

    const titles = { overview: ['Painel Geral','Monitoramento de despesas operacionais.'], annual: ['Balan√ßo Anual','Proje√ß√£o e realizado por m√™s.'], fixos: ['Custos Fixos','Despesas recorrentes da opera√ß√£o.'], unicos: ['Gastos Vari√°veis','Despesas pontuais e extras.'] };
    document.getElementById('page-title').textContent = titles[t][0];
    document.getElementById('page-sub').textContent = titles[t][1];

    if(t === 'overview') document.getElementById('view-overview').classList.add('active');
    else if(t === 'annual') document.getElementById('view-annual').classList.add('active');
    else { document.getElementById('view-list').classList.add('active'); }

    A.render();
  },

  async fetchSync(silent = false) {
    if(!silent) A.syncUI('load');
    try {
      const r = await fetch(DB.url, { headers: { apikey: DB.key, Authorization: `Bearer ${DB.key}` } });
      const d = await r.json();
      if(d && d[0]) {
        A.state.data.fixos = Array.isArray(d[0].fixos) ? d[0].fixos : JSON.parse(d[0].fixos || '[]');
        A.state.data.unicos = Array.isArray(d[0].unicos) ? d[0].unicos : JSON.parse(d[0].unicos || '[]');
      }
      A.syncUI('ok');
      A.render();
    } catch(e) { A.syncUI('err'); }
  },

  async pushSync() {
    A.syncUI('load');
    try {
      await fetch(DB.url, {
        method: 'PATCH',
        headers: { apikey: DB.key, Authorization: `Bearer ${DB.key}`, 'Content-Type': 'application/json', Prefer: 'return=minimal' },
        body: JSON.stringify({ fixos: A.state.data.fixos, unicos: A.state.data.unicos, updated_at: new Date().toISOString() })
      });
      A.syncUI('ok');
    } catch(e) { A.syncUI('err'); A.toast("Erro ao salvar na nuvem.", "err"); }
  },

  syncUI(s) {
    const dot = document.getElementById('sync-dot');
    const txt = document.getElementById('sync-txt');
    const map = { load: ['var(--warning)','Sincronizando...'], ok: ['var(--success)','Nuvem Conectada'], err: ['var(--danger)','Modo Offline'] };
    dot.style.background = map[s][0]; dot.style.boxShadow = `0 0 8px ${map[s][0]}`;
    txt.textContent = map[s][1];
  },

  // HELPERS
  maskMoney(e) {
    let v = e.target.value.replace(/\D/g,'');
    if(!v) { e.target.value = ''; return; }
    v = (parseInt(v)/100).toFixed(2);
    e.target.value = v.replace('.',',').replace(/(\d)(?=(\d{3})+(?!\d))/g,'$1.');
  },
  cleanMoney(s) { return parseFloat((s||'0').replace(/\./g,'').replace(',','.'))||0; },
  fmtR(v) { return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0); },
  fmtD(d) { if(!d) return '--'; const p = d.split('-'); return p.length===3?`${p[2]}/${p[1]}`:d; },
  parseDate(d) { if(!d) return null; const p = d.split('-'); return p.length===3?{y:+p[0],m:+p[1]-1,d:+p[2]}:null; },
  filterByMonth(arr, m, y) { return arr.filter(x => { const p = A.parseDate(x.data); return p && p.m === m && p.y === y; }); },
  filterByYear(arr, y) { return arr.filter(x => { const p = A.parseDate(x.data); return p && p.y === y; }); },

  render() {
    const mVal = document.getElementById('fMonth').value;
    const year = parseInt(document.getElementById('fYear').value);
    const t = A.state.tab;

    let fixos, unicos;
    if(mVal === 'anual') {
      fixos = A.filterByYear(A.state.data.fixos, year);
      unicos = A.filterByYear(A.state.data.unicos, year);
    } else {
      const mo = parseInt(mVal);
      fixos = A.filterByMonth(A.state.data.fixos, mo, year);
      unicos = A.filterByMonth(A.state.data.unicos, mo, year);
    }

    const sumF = fixos.reduce((a,b)=>a+Number(b.valor),0);
    const sumU = unicos.reduce((a,b)=>a+Number(b.valor),0);
    const subs = A.state.data.fixos.filter(x=>x.recorrente==='mensal'||x.recorrente==='proximo');
    const uniqueSubs = new Set(subs.map(x=>x.nome)).size;

    document.getElementById('v-total').textContent = A.fmtR(sumF+sumU);
    document.getElementById('v-fixos').textContent = A.fmtR(sumF);
    document.getElementById('v-unicos').textContent = A.fmtR(sumU);
    document.getElementById('v-subs').textContent = uniqueSubs;

    if(t === 'fixos' || t === 'unicos') A.renderTable(t === 'fixos' ? fixos : unicos);
    if(t === 'annual') A.renderAnnual(year);
    A.updateCharts();
  },

  renderTable(list) {
    const sorted = [...list].sort((a,b) => (b.data||'').localeCompare(a.data||''));
    const tbody = document.getElementById('table-body');
    const empty = document.getElementById('table-empty');
    if(sorted.length === 0) { tbody.innerHTML = ''; empty.style.display = 'block'; }
    else {
      empty.style.display = 'none';
      tbody.innerHTML = sorted.map(i => {
        const isPend = i.status === 'Pendente';
        const isRecur = i.recorrente === 'mensal' || i.recorrente === 'proximo';
        return `<tr>
          <td style="color:var(--text-muted);font-size:13px;font-weight:600;white-space:nowrap">${A.fmtD(i.data)}</td>
          <td>
            <div class="item-name">${esc(i.nome)}</div>
            ${i.descricao?`<div class="item-desc">${esc(i.descricao)}</div>`:''}
          </td>
          <td><span class="cat-badge">${esc(i.categoria||'‚Äî')}</span></td>
          <td><span class="recur-badge ${isRecur?'sim':'nao'}">${isRecur?'üîÑ Mensal':'√önico'}</span></td>
          <td><span class="status-badge ${isPend?'pendente':'pago'}">${isPend?'‚è≥ Pendente':'‚úÖ Pago'}</span></td>
          <td class="amount-cell font-title" style="color:${isPend?'var(--text-muted)':'var(--text)'}">${A.fmtR(i.valor)}</td>
          <td style="text-align:center;white-space:nowrap">
            <button class="action-btn" onclick="A.edit('${i.id}')" title="Editar"><i data-lucide="edit-2" width="16" height="16"></i></button>
            <button class="action-btn del" onclick="A.del('${i.id}')" title="Excluir"><i data-lucide="trash-2" width="16" height="16"></i></button>
          </td>
        </tr>`;
      }).join('');
      lucide.createIcons();
    }
  },

  renderAnnual(year) {
    document.getElementById('annual-title').textContent = `Balan√ßo Anual ${year}`;
    const grid = document.getElementById('annual-grid');
    const now = new Date();
    let allTotals = [];

    for(let m=0;m<12;m++) {
      const f = A.filterByMonth(A.state.data.fixos,m,year).reduce((a,b)=>a+Number(b.valor),0);
      const u = A.filterByMonth(A.state.data.unicos,m,year).reduce((a,b)=>a+Number(b.valor),0);
      allTotals.push(f+u);
    }
    const maxVal = Math.max(...allTotals, 1);
    const yearTotal = allTotals.reduce((a,b)=>a+b,0);
    const activeMths = allTotals.filter(v=>v>0).length||1;
    document.getElementById('annual-total').textContent = A.fmtR(yearTotal);
    document.getElementById('annual-avg').textContent = A.fmtR(yearTotal/activeMths);

    grid.innerHTML = MONTHS.map((name,m) => {
      const total = allTotals[m];
      const isCur = m === now.getMonth() && year === now.getFullYear();
      const pct = Math.round((total/maxVal)*100);
      return `<div class="month-tile${isCur?' current':''}" onclick="A.goToMonth(${m},${year})">
        <div class="month-tile-name">${name}${isCur?' <span style="font-size:10px;color:var(--primary)">‚óè Atual</span>':''}</div>
        <div class="month-tile-val font-title">${A.fmtR(total)}</div>
        <div class="month-tile-sub">${total>0?'Ver detalhes':'Sem lan√ßamentos'}</div>
        <div class="month-tile-bar"><div class="month-tile-fill" style="width:${pct}%"></div></div>
      </div>`;
    }).join('');
  },

  goToMonth(m, y) {
    document.getElementById('fMonth').value = m;
    document.getElementById('fYear').value = y;
    A.tab('fixos');
  },

  initCharts() {
    const baseOpts = { chart: { background:'transparent', fontFamily:'Inter', toolbar:{show:false}, animations:{enabled:true,speed:600} }, theme:{mode:'dark'} };

    A.ch.area = new ApexCharts(document.querySelector('#chart-area'), {
      ...baseOpts,
      series: [{name:'Total',data:[]}],
      chart:{...baseOpts.chart,type:'area',height:280},
      colors:['#0ea5e9'],
      fill:{type:'gradient',gradient:{shadeIntensity:1,opacityFrom:0.5,opacityTo:0.02,stops:[0,90,100]}},
      stroke:{curve:'smooth',width:3},
      dataLabels:{enabled:false},
      grid:{borderColor:'rgba(255,255,255,0.05)',strokeDashArray:4,xaxis:{lines:{show:false}}},
      xaxis:{categories:[],labels:{style:{colors:'#94a3b8',fontSize:'12px',fontWeight:600}},axisBorder:{show:false},axisTicks:{show:false}},
      yaxis:{labels:{style:{colors:'#94a3b8',fontSize:'11px'},formatter:v=>`R$${(v/1000).toFixed(0)}k`}},
      tooltip:{theme:'dark',y:{formatter:v=>A.fmtR(v)}}
    });
    A.ch.area.render();

    A.ch.donut = new ApexCharts(document.querySelector('#chart-donut'), {
      ...baseOpts,
      series:[], labels:[],
      chart:{...baseOpts.chart,type:'donut',height:280},
      colors:['#0ea5e9','#38bdf8','#7dd3fc','#bae6fd','#0284c7','#0369a1'],
      stroke:{show:true,colors:['#0d1117'],width:2},
      dataLabels:{enabled:false},
      legend:{position:'bottom',labels:{colors:'#94a3b8'},fontSize:'12px',fontWeight:600},
      plotOptions:{pie:{donut:{size:'72%',labels:{show:true,name:{color:'#94a3b8',fontSize:'13px'},value:{color:'white',fontSize:'22px',fontWeight:900,formatter:v=>A.fmtR(v)},total:{show:true,label:'Total Fixos',color:'#94a3b8',formatter:w=>A.fmtR(w.globals.seriesTotals.reduce((a,b)=>a+b,0))}}}}},
      tooltip:{theme:'dark',y:{formatter:v=>A.fmtR(v)}}
    });
    A.ch.donut.render();
  },

  updateCharts() {
    if(!A.ch.area) return;
    const aData=[], aCats=[];
    for(let i=5;i>=0;i--) {
      const d=new Date(); d.setDate(1); d.setMonth(d.getMonth()-i);
      const m=d.getMonth(), y=d.getFullYear();
      const f=A.filterByMonth(A.state.data.fixos,m,y).reduce((a,b)=>a+Number(b.valor),0);
      const u=A.filterByMonth(A.state.data.unicos,m,y).reduce((a,b)=>a+Number(b.valor),0);
      aData.push(f+u); aCats.push(MONTHS[m].substring(0,3));
    }
    A.ch.area.updateSeries([{data:aData}]);
    A.ch.area.updateOptions({xaxis:{categories:aCats}});

    const mVal = document.getElementById('fMonth').value;
    const year = parseInt(document.getElementById('fYear').value);
    let curFixos;
    if(mVal === 'anual') curFixos = A.filterByYear(A.state.data.fixos, year);
    else curFixos = A.filterByMonth(A.state.data.fixos, parseInt(mVal), year);

    const catMap = {};
    curFixos.forEach(x => { catMap[x.categoria]=(catMap[x.categoria]||0)+Number(x.valor); });
    const labels=Object.keys(catMap), series=Object.values(catMap);
    if(series.length>0) { A.ch.donut.updateOptions({labels}); A.ch.donut.updateSeries(series); }
    else { A.ch.donut.updateSeries([1]); A.ch.donut.updateOptions({labels:['Sem dados'],colors:['#1e293b']}); }
  },

  // ‚îÄ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ‚îÄ
  openDrawer(item=null) {
    document.getElementById('drawer').classList.add('open');
    document.getElementById('overlay').classList.add('open');
    document.getElementById('drawer-title').textContent = item ? 'Editar Gasto' : 'Novo Lan√ßamento';
    if(item) {
      const isFixo = A.state.data.fixos.some(i=>i.id===item.id);
      A.setType(isFixo?'fixos':'unicos');
      document.getElementById('f-id').value = item.id;
      document.getElementById('f-nome').value = item.nome;
      document.getElementById('f-valor').value = A.fmtR(item.valor).replace('R$\u00a0','').replace('R$','').trim();
      document.getElementById('f-data').value = item.data||'';
      document.getElementById('f-cat').value = item.categoria||'';
      document.getElementById('f-status').value = item.status||'Pago';
      document.getElementById('f-desc').value = item.descricao||'';
      document.getElementById('f-recor').value = item.recorrente||'unico';
      A.onRecorChange();
    } else {
      const defType = A.state.tab==='unicos'?'unicos':'fixos';
      A.setType(defType);
      document.getElementById('f-id').value='';
      document.getElementById('f-nome').value='';
      document.getElementById('f-valor').value='';
      document.getElementById('f-data').value=new Date().toISOString().split('T')[0];
      document.getElementById('f-status').value='Pago';
      document.getElementById('f-desc').value='';
      document.getElementById('f-recor').value='unico';
      A.onRecorChange();
    }
    lucide.createIcons();
  },
  closeDrawer() {
    document.getElementById('drawer').classList.remove('open');
    document.getElementById('overlay').classList.remove('open');
  },
  setType(t) {
    A.state.type=t;
    document.getElementById('tab-fixos').classList.toggle('active',t==='fixos');
    document.getElementById('tab-unicos').classList.toggle('active',t==='unicos');
    const sel=document.getElementById('f-cat'); sel.innerHTML='';
    CATS[t].forEach(c => sel.innerHTML+=`<option value="${c}">${c}</option>`);
  },
  onRecorChange() {
    const v=document.getElementById('f-recor').value;
    document.getElementById('recor-hint').textContent=RECOR_HINTS[v]||'';
  },

  // ‚îÄ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ‚îÄ
  save() {
    const nome = document.getElementById('f-nome').value.trim();
    const valor = A.cleanMoney(document.getElementById('f-valor').value);
    if(!nome || valor<=0) { A.toast("Preencha nome e valor v√°lido.","err"); return; }

    const dataBase = document.getElementById('f-data').value;
    const recorrente = document.getElementById('f-recor').value;
    const editId = document.getElementById('f-id').value;

    const base = {
      nome, valor,
      data: dataBase,
      categoria: document.getElementById('f-cat').value,
      status: document.getElementById('f-status').value,
      descricao: document.getElementById('f-desc').value.trim(),
      recorrente
    };

    const arr = A.state.data[A.state.type];

    if(editId) {
      // Edit
      const idx = arr.findIndex(i=>i.id===editId);
      if(idx>=0) arr[idx]={...arr[idx],...base};
      else arr.push({id:editId,...base});
    } else {
      // Create
      if(recorrente==='mensal') {
        const [y,,d] = dataBase.split('-');
        for(let m=0;m<12;m++) {
          arr.push({id:`bgt_${Date.now()}_${m}`,...base,data:`${y}-${String(m+1).padStart(2,'0')}-${d}`});
        }
        A.toast("12 lan√ßamentos mensais criados! ‚ú®");
      } else if(recorrente==='proximo') {
        const [y,mo,d] = dataBase.split('-');
        const startM = parseInt(mo)-1;
        let count=0;
        for(let m=startM;m<12;m++) {
          arr.push({id:`bgt_${Date.now()}_${m}`,...base,data:`${y}-${String(m+1).padStart(2,'0')}-${d}`});
          count++;
        }
        A.toast(`${count} lan√ßamentos criados (${MONTHS[startM]} ‚Üí Dezembro)! ‚ú®`);
      } else {
        arr.push({id:`bgt_${Date.now()}`,...base});
        A.toast("Registro salvo com sucesso!");
      }
    }

    // Remove from other array if switching type
    const other = A.state.type==='fixos'?'unicos':'fixos';
    if(editId) A.state.data[other] = A.state.data[other].filter(i=>i.id!==editId);

    A.closeDrawer(); A.render(); A.pushSync();
  },

  edit(id) {
    const item = A.state.data.fixos.find(i=>i.id===id)||A.state.data.unicos.find(i=>i.id===id);
    if(item) A.openDrawer(item);
  },
  del(id) {
    if(confirm("Confirmar exclus√£o permanente deste registro?")) {
      A.state.data.fixos = A.state.data.fixos.filter(i=>i.id!==id);
      A.state.data.unicos = A.state.data.unicos.filter(i=>i.id!==id);
      A.render(); A.pushSync(); A.toast("Registro exclu√≠do.");
    }
  },

  toast(msg, type='ok') {
    const w=document.getElementById('toast-wrap');
    const t=document.createElement('div');
    t.className=`toast${type==='err'?' err':''}`;
    const icon = type==='err'?'alert-circle':'check-circle';
    const col = type==='err'?'#ef4444':'#10b981';
    t.innerHTML=`<i data-lucide="${icon}" width="18" height="18" style="color:${col};flex-shrink:0"></i><span>${msg}</span>`;
    w.appendChild(t); lucide.createIcons();
    setTimeout(()=>t.classList.add('show'),10);
    setTimeout(()=>{t.classList.remove('show');setTimeout(()=>t.remove(),400);},4000);
  }
};

function esc(s){ const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }

window.onload = A.init;
</script>
</body>
</html>
